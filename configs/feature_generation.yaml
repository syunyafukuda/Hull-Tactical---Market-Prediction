su1:
  id_column: date_id
  exclude_columns:
    - forward_returns
    - risk_free_rate
    - market_forward_excess_returns
  groups:
    include: ["M", "E", "I", "P", "S", "V"]
    exclude: []
  gap_clip: 60
  run_clip: 60
  dtype:
    flag: uint8
    run: int16
  include_group_means:
    gap_ffill: true
    run_na: true
    exclude_all_nan: true
  data:
    raw_dir: data/raw
    train_filename: train.csv
    test_filename: test.csv
  metadata:
    artifacts_dir: artifacts/SU1
    kaggle_lb: 0.674
    numpy_version: 1.26.4
    updated_at: 2025-11-04
    notes: "Artifacts regenerated with uv under pinned numpy 1.26.4 to keep MT19937 compatibility."

su2:
  # ⚠️ SU2は非採用 (2025-11-21決定)
  # 理由: LB 0.597 (SU1の0.674から-0.077ポイント大幅悪化)
  # 原因: 935個の二次特徴量による過学習・汎化性能低下
  # 結論: SU1をベースラインとして継続採用
  enabled: false
  base_features: su1
  id_column: date_id
  # 最終確定: config_id=3 (2025-11-07)
  input_sources: [m, gap_ffill, run_na, run_obs]
  target_groups:
    include: ["D", "M", "E", "I", "P", "S", "V"]
    exclude: []
  # 固定パラメータ（スイープ停止）
  rolling_windows: [5]
  ewma_alpha: [0.1]
  recovery_clip: 60
  dtype:
    flag: uint8
    run: int16
    float: float32
  features:
    rolling:
      include_metrics: [mean, std]
      include_current: [false]
      fill_missing_with_zero: true
    ewma:
      signals: [m, gap_ffill]
      include_std: [true]
      reset_each_fold: [true]
    transitions:
      windows: [5, 10, 20, 60]
      flip_rate_windows: [5, 10, 20, 60]
      burst_score_windows: [5, 10, 20, 60]
      recovery_feature: true
    normalization:
      windows: [5, 10, 20, 60]
      minmax_windows: [5, 10, 20, 60]
      rank_windows: [5, 10, 20, 60]
      epsilon: 1.0e-6
  include_rolling: [true]
  include_ewma: [true]
  include_transitions: [true]
  include_normalization: [true]
  normalization_mode: [both]
  epsilon: [1.0e-6]
  output_prefix: su2
  clip_max: 30
  drop_constant_columns: [true]
  metadata:
    artifacts_dir: artifacts/SU2
    depends_on: SU1
    expected_usage: "Roll-based missingness regime detection over SU1 outputs"
    numpy_version: 1.26.4
    status: deprecated  # stable → deprecated
    kaggle_lb: 0.597  
    oof_rmse: 0.01223  
    decision: not_adopted  
    updated_at: 2025-11-21  
    notes: "⚠️ NON-ADOPTED: LB score 0.597 (vs SU1's 0.674). Overfitting due to 935 secondary features. Stage2 best config (id=3) parameters preserved for reference: windows=[5], alpha=0.1, transitions/normalization windows=[5,10,20,60], metrics=mean|std, signals=m|gap_ffill, recovery_clip=60, clip_max=30."

su3:
  # ❌ SU3 完全放棄 (2025-11-22決定)
  # 理由: LB 0.461 (初回も修正版も変化なし)、OOF MSRがSU1の65%しかない
  # 原因: 欠損パターンの二次特徴化が本コンペでは無効、根本的なコンセプトの失敗
  # 結論: Stage 2は開発しない、SU1をベースラインとして継続採用
  enabled: false  # ❌ 完全放棄
  base_features: su1
  id_column: date_id
  output_prefix: su3
  
  # ========================================
  # Stage 1 構成（参考保存のみ）
  # ========================================
  # OOF性能:
  #   - RMSE: 0.011418
  #   - MSR: 0.017162 ← ❌ SU1の0.026376の65.1%（大幅劣化）
  #   - 特徴量数: 444列 (SU1: 368列 + SU3: 76列)
  # 
  # LB推移:
  #   - 初回提出（fold_indices不整合あり）: 0.461
  #   - 修正版（fold_indices不整合解消）: 0.461 ← ❌ 変化なし
  # 
  # 問題分析:
  #   ❌ OOF時点で致命的な性能劣化（MSR 65%）
  #   ❌ 修正してもLBスコア不変（コンセプトの失敗）
  #   ❌ テストデータで予測崩壊（全て同じ値）
  #   ❌ 欠損パターンの高次特徴化が本コンペでは無効
  # 
  # 教訓:
  #   - SU1（一次欠損特徴）が最適解、これ以上の複雑化は不要
  #   - OOF MSRがベースラインの65%の時点で採用すべきでなかった
  #   - Stage 2の開発は時間の無駄
  # ========================================
  
  # Stage 1構成（参考）
  include_transitions: true
  transition_group_agg: true
  
  include_reappearance: true
  reappear_clip: 60
  reappear_top_k: 20
  
  include_imputation_trace: false
  imp_delta_winsorize_p: 0.99
  imp_delta_top_k: 20
  imp_policy_group_level: true
  
  include_temporal_bias: true
  temporal_burn_in: 3
  temporal_top_k: 10
  
  include_holiday_interaction: true
  holiday_top_k: 10
  
  dtype:
    flag: uint8
    int: int16
    float: float32
  
  reset_each_fold: true
  
  metadata:
    artifacts_dir: artifacts/SU3
    depends_on: SU1
    expected_usage: "[DEPRECATED] Transition, reappearance, temporal bias features"
    numpy_version: 1.26.4
    status: deprecated  # adoption_pending → deprecated
    stage: 1
    kaggle_lb: 0.461  # 初回・修正版ともに変化なし
    oof_rmse: 0.011418
    oof_msr: 0.017162  # SU1の65.1%
    feature_count: 444
    decision: fully_abandoned  # stage1_adopted → fully_abandoned
    abandonment_reason: "LBスコア0.461（SU1の0.674から-0.213）、OOF MSR SU1比65%、修正の効果なし"
    troubleshooting:
      - issue: "fold_indices不整合"
        fix: "最終学習時にfold_indicesを渡さない（推論時と一致）"
        result: "LBスコア不変（0.461）、修正は無意味だった"
        doc: "docs/feature_generation/SU3_LB_COLLAPSE_ANALYSIS.md"
      - issue: "MSR=0問題"
        cause: "PostProcessParams(lo=1.0, hi=1.0)でシグナル定数化"
        fix: "lo=0.0, hi=2.0に変更"
        doc: "docs/feature_generation/troubleshooting/MSR_zero_issue.md"
    updated_at: 2025-11-22
    notes: "❌ 完全放棄。LB 0.461（初回・修正版ともに変化なし）、OOF MSR SU1の65%。欠損パターンの高次特徴化は本コンペでは無効と判断。Stage 2は開発しない。SU1をベースラインとして継続採用。"

su5:
  enabled: true
  base_features: su1
  id_column: date_id
  output_prefix: su5

  # ========================================
  # 採用構成（Policy1）: top_k=10, windows=[5]
  # LB score: 0.681 (SU1の0.674から+0.007、+1.04%改善)
  # OOF RMSE: 0.012139
  # OOF MSR: 0.024071
  # Features: 567 (SU1:368 + SU5:105)
  # ========================================
  top_k_pairs: 10
  top_k_pairs_per_group: null
  windows: [5]
  reset_each_fold: true

  dtype:
    flag: uint8
    int: int16
    float: float32

  metadata:
    artifacts_dir: artifacts/SU5/policy1_top10_w5
    depends_on: SU1
    expected_usage: "Co-missing structure features (top-K pairs, rolling co-miss rate, degree)"
    numpy_version: 1.26.4
    status: adopted
    decision_date: 2025-11-23
    kaggle_lb: 0.681
    oof_rmse: 0.012139
    oof_msr: 0.024071
    feature_count: 567
    baseline_su1_lb: 0.674
    improvement: "+0.007 (+1.04%)"
    policy_comparison:
      policy1:
        top_k: 10
        windows: [5]
        lb_score: 0.681
        adopted: true
      policy2:
        top_k: 5
        windows: [5, 20]
        lb_score: 0.679
        adopted: false
    notes: "✅ ADOPTED: Policy1 achieves LB 0.681 (best score ever). Policy2 scored 0.679. Policy1 selected for simpler configuration and higher LB."