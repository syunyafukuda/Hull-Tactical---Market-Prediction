# Walk-Forward CV 設定
# 最終更新: 2025-12-14
# ステータス: 確定版（ローカル検証完了）

# Walk-Forward モード
# - expanding: train_start 固定、train_end のみ拡大（推奨）
# - rolling: train_start も step で移動
mode: expanding

# ウィンドウ設定
train_window: 6000   # 学習日数（約24年相当）
val_window: 1000     # 検証日数（約4年相当）
step: 500            # ウィンドウ移動量（4-fold 生成用に 1000→500 に変更）

# 制約
min_folds: 4         # 最小 fold 数（安定性検証のため 3→4 に変更）
gap: 0               # train/val 間のギャップ（リーク防止用）

# 評価設定
eval_sharpe: true    # Hull Sharpe を計算
eval_rmse: true      # RMSE も計算（参考用）

# prediction → position マッピング（最適化済み）
# sharpe_mult: 20 は Vol Ratio を 0.8-1.2 範囲内に収めるための最適値
# チューニング経緯: 100→50→30→20 で検証、20 が Mean Sharpe +0.11 で最良
signal:
  mult: 20.0         # 予測値にかける係数（デフォルト 1.0 → 20.0 に最適化）
  offset: 1.0        # 加算オフセット（position = pred * mult + offset）
  clip_min: 0.0      # 最小投資比率
  clip_max: 2.0      # 最大投資比率

# -----------------------------------------------------------------------------
# Alpha-Beta Position Mapping (Kaggle discussion/611071)
# -----------------------------------------------------------------------------
# Grid Search 結果 (2025-12-14, OOF 2500 samples)
#
# | 設定        | alpha | beta | OOF Sharpe | pos_mean | clip率(min/max) | 備考           |
# |-------------|-------|------|------------|----------|-----------------|----------------|
# | Do-nothing  |     0 | 0.81 |      0.797 |     0.81 |       0%/0%     | ベースライン   |
# | Conservative|   100 |  1.2 |      0.838 |     0.98 |     0.6%/4.5%   | 低リスク       |
# | Moderate★  |   200 |  1.5 |      0.912 |     1.01 |     8.4%/13.1%  | 推奨（採用）   |
# | Aggressive  |   350 |  2.0 |      0.969 |     1.06 |    19.6%/25.3%  | 過学習リスク   |
#
# 採用基準: クリッピング率 < 15% AND OOF Sharpe > 0.85
# → Moderate (alpha=200, beta=1.5) を採用

position_mapping:
  # ★ 推奨設定 (Moderate) - 2025-12-14 Grid Search で決定
  alpha: 200.0          # Prediction scale (高めだがクリップ率許容範囲)
  beta: 1.5             # Offset (市場平均より若干高め)
  clip_min: 0.0         # Min position (100% cash)
  clip_max: 2.0         # Max position (200% market)
  winsor_pct: null      # Winsorization なし（効果なしと判明）

  # --- 次点候補 (Conservative) ---
  # alpha: 100.0
  # beta: 1.2
  # → OOF Sharpe: 0.838, clip率: 0.6%/4.5%
  # → より保守的にしたい場合はこちら

  # --- Do-nothing baseline (比較用) ---
  # alpha: 0.0
  # beta: 0.806
  # → OOF Sharpe: 0.797（予測を使わない定数ポジション）

# 出力設定
output:
  fold_csv: true           # walk_forward_folds.csv を出力
  summary_json: true       # hull_sharpe_summary.json を出力
  include_penalties: true  # ペナルティ内訳を含める

# Grid Search 詳細結果
# - 探索範囲: alpha=[0-400], beta=[0.5-2.0], winsor=[0-0.05]
# - winsor_pct は全設定で効果なし（既にクリップで外れ値処理済み）
# - alpha が大きいほど Sharpe 向上するがクリップ率も増加
# - 結果ファイル: results/position_sweep/alpha_beta_search.csv